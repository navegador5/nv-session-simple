var bwprom=(()=>{var e,t;return(e=(e,t)=>{var _=Object.defineProperty,f=Symbol("tmout"),h=Symbol("too_early"),n=2**31-2;function a(e,t,r,...n){let a=[];var s;return 0===r?(s=setTimeout(t,0,...n),a.push(s)):(s=r%e,function e(t,r,n,a,s,...u){var i;0===n?0===s?a(...u):(i=setTimeout(a,s,...u),t.push(i)):(i=setTimeout(()=>{e(t,r,n-1,a,s,...u)},r),t.push(i))}(a,e,(r-s)/e,t,s,...n)),a}function o(e,t,...r){return a(n,e,t,...r)}function c(e){e.forEach(e=>clearTimeout(e))}function s(e){e.p.clear(),e.cancel=!0}var u=class{constructor(){this.p={clear:()=>{}},this.cancel=!1}};async function i(e,t,r,n,...a){var s;for await(s of async function*(e,t,r,...n){let a=(r=!(r instanceof Array)?[r]:r).length,s=0;for(;!e.cancel;){var u=p(r[s%a]);if(await(e.p=u),e.cancel)break;yield await t(...n),s+=1}}(e,r,n,...a))void 0!==t&&t.push(s)}function l(){let r,n;return[new Promise((e,t)=>{r=e,n=t}),r,n]}function r(e,t,r){let[n,a,s]=l(),u=0===e?a:s,i=o((e,t)=>{u(r)},t,a,s);return n.clear=()=>{c(i),a()},n}function p(e){return r(0,e,!0)}function m(e,t,...r){let[n,,a]=l();return o(()=>{a(e)},t,...r),n}function d(e,t,r,...n){let[a,s,u]=l(),i=e?s:u;return o(()=>{i(t)},r,...n),a}function v(e,t,...r){e=m(f,e),r=t(...r);return Promise.race([e,r])}d.ACT={rs:1,rj:0};var w=class extends Error{json(){return{name:this.name,message:parseFloat(this.message),stack:this.stack}}};function g(e,n,a=!1,s=f,u){if(void 0===n)return e;var t=new Promise((e,t)=>{let r=o(()=>{c(r),r.forEach(e=>null),a?e(s):(u??new w(n),t(u))},n)});return e=Promise.race([e,t])}function T(e,t=!1,r=f,n){var[,a,s]=l();return[g(e,t,r,n),a,s]}function y(){return(new Date).getTime()}var j=class extends Array{pusht(){var t=y();if(0===this.length)this.push([t,null]);else{let e=this[this.length-1];null===e[0]?e[0]=t:null===e[1]?e[1]=t:this.push([t,null])}}get lst_(){return this[this.length-1]}get passed_(){let e=0;for(var t of this){if(null===t[1]){e=e+y()-t[0];break}e=e+t[1]-t[0]}return e}clear(){return this.splice(0,this.length),this}reset(){this.clear(),this.pusht()}};function b(e,t,r){r=r??e;let n=o(()=>{t(new w(r))},e);return n.clear=()=>c(n),n}t.exports={USAGE:()=>console.log(`
const {
    _psj,wait,ka,
    delay_rsv,delay_rjv,
    newSetTimeout,newClearTimeout,
    tmoutp,
    creat_random_tmout_settle,creat_set_tmout_at,
    rplc_rslt,rplc_err,
    now
} = bwprom`),TMOUT:f,TOO_EARLY:h,creat_setmout_resolve:function(e,t,...r){let[n,a]=l();return o(()=>{a(e)},t,...r),n},creat_setmout_reject:m,creat_setmout_settle:d,creat_set_tmout_at:function(e,t,...r){var n=(e=!(e instanceof Date)?new Date(e):e).getTime(),e=(new Date).getTime();return n<e?Promise.reject("must-ge-now"):v(n-e,t,...r)},creat_tmout_promise:v,creat_random_tmout_settle:function(e,t,...r){return d(Math.floor(2*Math.random()),e,t,...r)},MAX_NODEJS_TMOUT:n,_newSetTimeout:a,newSetTimeout:o,newClearTimeout:c,_psj:l,wait:p,delay_rsv:function(e,t){return r(0,e,t)},delay_rjv:function(e,t){return r(1,e,t)},tmoutp:g,psj:T,psj_tm_between:function(r,e,n=h,t=f,a=!1,s){let[u,i,o]=T(e,a,s,t),c;if(void 0!==r){let t=y();c=e=>{y()-t>=r?i(e):(a?i:o)(n)}}else c=i;let l;if(void 0!==r){let t=y();l=e=>{y()-t>=r?o(e):(a?i:o)(n)}}else l=o;return[u,c,l]},TmoutError:w,TimeRangeCache:j,ka:function(n,t=e=>{},r=e=>{}){let a,s=new j;s.pusht();let u=!1,i=!1,o=!1,c=!1,[l,e,f]=T();return l.then(e=>{r(e)}).catch(e=>{s.pusht(),u=!0,void 0!==a&&a.clear(),t(e)}),a=b(n,f),l.immediate=()=>{if(i||u)return!1;c=c&&!1,a.clear(),f(new w(l.passed_))},l.cancel=()=>!!i||!u&&(i=!0,c?c=!1:s.pusht(),void 0!==a&&a.clear(),void e("canceled")),l.pause=()=>!!c||!i&&!u&&(s.pusht(),a.clear(),void(c=!0)),l.continue=()=>{if(!c)return!1;s.pusht();var e=l.lefted_;a=b(e,f,n),c=!1},l.renew=(e=!0)=>!(i||u||o)&&(a.clear(),s.reset(),a=b(n,f),c&&(c=!1,e||l.pause()),!0),l.never=()=>!i&&!u&&(o||(a.clear(),o=!0),!0),l.postpone=e=>{if(i||u)return!1;if(o)return!0;var t=l.lefted_;return a.clear(),a=b(t+e,f,n+e),n+=e,c&&(c=!1,this.pause()),!0},l.ahead=e=>{if(diff=-e,i||u||o)return!1;var t=l.passed_;if(n-e-t<=0)return l.immediate();t=l.passed_;return a.clear(),a=b(n-e-t,f,n-e),n-=e,c&&(c=!1,this.pause()),!0},l.change=(e,t=!1)=>{if(e=t?n+e:e,i||u)return!1;if(o)return e===1/0||(o=!1,n=e,a=b(n,f),c&&(c=!1,this.pause())),!0;if(e<n){var r=l.ahead(n-e);return n=e,r}if(e===n)return!0;r=l.postpone(e-n);return n=e,r},l.is_tmouted=()=>u,l.is_nevered=()=>o,l.is_canceled=()=>i,l.is_paused=()=>c,_(l,"tmout_",{get:()=>n}),_(l,"cache_",{get:()=>s}),_(l,"passed_",{get:()=>s.passed_}),_(l,"lefted_",{get:()=>i||u?-1:o?1/0:n-s.passed_}),l},set_interval:function(e,t,...r){let n=[],a=new u;return i(a,n,e,t,...r),{rslts:n,newClearInterval:()=>s(a)}},set_interval_without_rslts:function(e,t,...r){let n=new u;return i(n,void 0,e,t,...r),{newClearInterval:()=>s(n)}},rplc:function(e,t,r){let[n,a,s]=l();return e.then(e=>{a(t)}).catch(e=>{s(r)}),n},rplc_rslt:function(e,t){let[r,n,a]=l();return e.then(e=>{n(t)}).catch(e=>{a(e)}),r},rplc_err:function(e,t){let[r,n,a]=l();return e.then(e=>{n(e)}).catch(e=>{a(t)}),r},now:y}},()=>(t||e((t={exports:{}}).exports,t),t.exports))()})();

module.exports = bwprom;
